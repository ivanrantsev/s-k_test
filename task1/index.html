<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Document</title>
</head>
<body>
    <div id="app">
        <form class="content">
            <select id='leftMS' multiple>
                <option value="item1_value">item1</option>
                <option value="item2_value">item2</option>
                <option value="item3_value">item3</option>
                <option value="item4_value">item4</option>
                <option value="item5_value">item5</option>
            </select>
            <div class="control">
                <div id="toRight">&#8680;</div>
                <div id="toLeft">&#8678;</div>
                <div id="allToRight">&#8694;</div>
                <div id="allToLeft">&#11057;</div>
                <div id="sent">&#9993;</div>
            </div>
        </form>
    </div>
    <script>

        class MultiSel {
            constructor(sel) {
                this.sel = sel
            }
            opts = {};
            check = false; 

            init() {
                if (this.check) {
                    return;
                }
                $('.control').css({'display':'flex'});
                $('.content').append('<select id="rightMS" multiple></select>');
                let result = {};
                let items = this.sel && this.sel.options;
                let count = 0;
                for (let i=0; i<items.length; i++) {
                    let opt = items[i];
                    result[count] = {};
                    result[count].name = opt.text;
                    result[count].value = opt.value;
                        if (opt.selected) {
                            if (result[count].selected === 'selected') {
                                delete result[count].selected;
                            } else {
                                result[count].selected = 'selected';
                            } 
                        }
                    count++;
                }
                this.opts = Object.assign({}, result);
                //let size = Object.keys(opts).length;
                this.drawAgain();
                this.check = true;

                $('#leftMS').dblclick(function(event) {
                    let target = event.target;
                    if (target.tagName !== 'OPTION') {
                        return;
                    } 
                    let size = Object.keys(this.opts).length;
                    for (let i = 0; i < size; i++) {
                        if (this.opts[i].name === target.textContent) {
                            this.opts[i].selected = 'selected';
                        }
                    }
                    this.drawAgain();
                });

                $('#rightMS').dblclick(function(event) {
                    let target = event.target;
                    if (target.tagName !== 'OPTION') {
                        return;
                    } 
                    let size = Object.keys(this.opts).length;
                    for (let i = 0; i < size; i++) {
                        if (this.opts[i].name === target.textContent) {
                            delete this.opts[i].selected;
                        }       
                    }
                    this.drawAgain();
                });


                $('#toRight').click(function(){
                    let values = $('#leftMS').val();
                    let size = Object.keys(this.opts).length;
                    for (let i = 0; i < size; i++) {
                        if (values.includes(this.opts[i].value)) {
                            this.opts[i].selected = 'selected';
                        }
                    }
                    this.drawAgain();
                });

                $('#toLeft').click(function(){
                    let values = $('#rightMS').val();
                    let size = Object.keys(this.opts).length;
                    for (let i = 0; i < size; i++) {
                        if (values.includes(this.opts[i].value)) {
                            delete this.opts[i].selected;
                        }
                    }
                    this.drawAgain();
                });

                $('#allToLeft').click(function() {
                    let size = Object.keys(this.opts).length;
                    for (let i = 0; i < size; i++) {
                        if (this.opts[i].selected === 'selected') {
                            delete this.opts[i].selected;
                        }
                    }
                    this.drawAgain();
                });

                $('#allToRight').click(function(){
                    let size = Object.keys(this.opts).length;
                    for (let i = 0; i < size; i++) {
                        if (this.opts[i].selected !== 'selected') {
                            this.opts[i].selected = 'selected';
                        }
                    }
                    this.drawAgain();
                });

                $('#sent').click(function() {
                    let size = Object.keys(this.opts).length;
                    for (let i = 0; i < size; i++) {
                        if (this.opts[i].selected === 'selected') {
                            console.log(this.opts[i].name);
                        }
                    }
                });
            }

            create() {
                if (!this.check) {
                    return
                }
                $.getJSON('appendix_1.json', function(data) {
                    let size1 = Object.keys(this.opts).length;
                    let size2 = Object.keys(data.data).length;
                    let count = size1;
                    for (let i = 0; i < size1 + size2; i++) {
                        this.opts[count] = data.data[i];
                        count++;
                    }
                    this.drawAgain();
                });
            }


            drawAgain() {
                let size = Object.keys(this.opts).length;
                $('#rightMS').html('');
                $('#leftMS').html('');
                for (let i = 0; i < size; i++) {
                    if (this.opts[i].selected === 'selected') {
                        $('#rightMS').append(`<option value='${this.opts[i].value}' selected='selected'>${this.opts[i].name}</option>`);
                    } else {
                        $('#leftMS').append(`<option value='${this.opts[i].value}'>${this.opts[i].name}</option>`);
                    }
                }
            }
        }

        let leftMS = document.querySelector('#leftMS');
        let rightMS = document.querySelector('#rightMS');

        let twoSide = new MultiSel(leftMS);


        
            

        
        

        

        


        
    </script>
</body>
</html>